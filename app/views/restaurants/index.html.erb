<% if @restaurants.any? %>
  <% @restaurants.each do |restaurant| %>
    <h2><%= link_to restaurant.name, restaurant_path(restaurant) %></h2>
    <%= link_to "Edit #{restaurant.name}", edit_restaurant_path(restaurant) %>
    <%= link_to "Delete #{restaurant.name}", restaurant_path(restaurant), method: :delete %>
    <%= link_to "Review #{restaurant.name}", new_restaurant_review_path(restaurant) %>
    <h3>Average rating: <%= star_rating(restaurant.average_rating) %></h3>
    <ul>
      <% restaurant.reviews.each do |review| %>
        <li><%= star_rating(review.rating) %> <%= review.comment %> - <i>posted by <%= User.find(review.user_id).email %> <%= time_ago_in_words(review.created_at) %> ago</i>
        <% if user_signed_in? && review.user_id == current_user.id %>
          <%= link_to 'Edit review', edit_review_path(review) %>
          <%= link_to 'Delete review', review_path(review), method: :delete %>
        <% elsif user_signed_in? %>
          <%= link_to 'Endorse this review', review_endorsements_path(review), class: "endorsements-link" %>
        <% end %>
        <span class="endorsements-count"><%= pluralize(review.endorsements.count, 'endorsement') %></span>
        </li>
      <% end %>
    </ul>
  <% end %>
<% else %>
  No restaurants yet!
<% end %>

<%= link_to "Add a restaurant", new_restaurant_path %>